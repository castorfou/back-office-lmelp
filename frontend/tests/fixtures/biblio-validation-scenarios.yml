# Sc√©narios BiblioValidationService End-to-End
# Chaque sc√©nario d√©finit la s√©quence d'appels et le r√©sultat attendu

scenarios:
  # ‚úÖ VALIDATED CASES
  - name: "Ground truth confirme donn√©es identiques - Maria Pourchet"
    description: "Ground truth reconstruit exactement les m√™mes donn√©es que l'original, confirm√© par Babelio"
    input:
      author: "Maria Pourchet"
      title: "Tressaillir"
      publisher: "Stock"
      episodeId: "68c707ad6e51b9428ab87e9e"  # pragma: allowlist secret
    calls:
      - service: "fuzzySearch"
        ref: "Maria Pourchet - Tressaillir exact match"
      - service: "babelioAuthor"
        ref: "Maria Pourchet - verified"
      - service: "babelioBook"
        ref: "Tressaillir + Maria Pourchet ‚Üí VERIFIED"
    expected:
      status: "validated"
      source: "ground_truth+babelio"
      confidence_score: 1.0

  - name: "Non trouv√© r√©el - Christophe Bigot"
    description: "Auteur v√©rifi√© mais livre non trouv√© sur Babelio (faux positif actuel dans l'interface)"
    input:
      author: "Christophe Bigot"
      title: "Un autre Matin ailleurs"
      publisher: "√âditeur"
      episodeId: "68c707ad6e51b9428ab87e9e"  # pragma: allowlist secret
    calls:
      - service: "fuzzySearch"
        ref: "Christophe Bigot - Un autre Matin ailleurs"
      - service: "babelioAuthor"
        ref: "Christophe Bigot - exact match"
      - service: "babelioBook"
        ref: "Un autre Matin ailleurs + Christophe Bigot ‚Üí NOT FOUND"
    expected:
      status: "not_found"
      reason: "no_reliable_match_found"
      attempts: ["ground_truth", "babelio"]

  # üîÑ SUGGESTION CASES
  - name: "Correction auteur seulement - Alain Mabancou"
    description: "Livre n'existe que sous le nom d'auteur corrig√©"
    input:
      author: "Alain Mabancou"
      title: "Rams√®s de Paris"
      publisher: "Seuil"
      episodeId: "68c707ad6e51b9428ab87e9e"  # pragma: allowlist secret
    calls:
      - service: "fuzzySearch"
        ref: "Alain Mabancou - Rams√®s de Paris"
      - service: "babelioAuthor"
        ref: "Alain Mabancou ‚Üí Alain Mabanckou"
      - service: "babelioBook"
        ref: "Rams√®s de Paris + Alain Mabancou (original) ‚Üí NOT FOUND"
      - service: "babelioBook"  # Deuxi√®me appel avec auteur corrig√©
        ref: "Rams√®s de Paris + Alain Mabanckou (corrig√©) ‚Üí VERIFIED"
    expected:
      status: "suggestion"
      author: "Alain Mabanckou"
      title: "Rams√®s de Paris"
      corrections:
        author: true
        title: false

  - name: "Cascade de suggestions - Caroline Dussain"
    description: "Auteur sugg√®re un autre auteur, puis livre sugg√®re le bon auteur final"
    input:
      author: "Caroline Dussain"
      title: "Un d√©ni fran√ßais"
      publisher: "√âditeur"
      episodeId: "68c707ad6e51b9428ab87e9e"  # pragma: allowlist secret
    calls:
      - service: "fuzzySearch"
        ref: "Caroline Dussain - Un d√©ni fran√ßais"
      - service: "babelioAuthor"
        ref: "Caroline Dussain ‚Üí Caroline Dawson"
      - service: "babelioBook"
        ref: "Un d√©ni fran√ßais + Caroline Dawson ‚Üí Caroline du Saint"
      - service: "babelioBook"  # Coherence check
        ref: "Un D√©ni fran√ßais... + Caroline du Saint ‚Üí VERIFIED"
    expected:
      status: "suggestion"
      author: "Caroline du Saint"
      title: "Un D√©ni fran√ßais - Enqu√™te sur l'√©levage industrie..."
      corrections:
        author: true
        title: true

  - name: "Ground truth prioritaire - Emmanuel Carr√®re Kolkhoze"
    description: "Ground truth sugg√®re Kolkhoze, confirm√© par Babelio"
    input:
      author: "Emmanuel Carr√®re"
      title: "Colcause"
      publisher: "POL"
      episodeId: "68bd9ed3582cf994fb66f1d6"  # pragma: allowlist secret
    calls:
      - service: "fuzzySearch"
        ref: "Emmanuel Carr√®re - Colcause"
      - service: "babelioAuthor"
        ref: "Emmanuel Carr√®re - exact match"
      - service: "babelioBook"
        ref: "Kolkhoze + Emmanuel Carr√®re ‚Üí VERIFIED"
    expected:
      status: "suggestion"
      author: "Emmanuel Carr√®re"
      title: "Kolkhoze"
      corrections:
        author: false
        title: true
      source: "ground_truth+babelio"

  - name: "Ground truth am√©lior√© - Yakuta Ali Kavazovic"
    description: "Ground truth d√©tecte la correction gr√¢ce aux seuils ajust√©s"
    input:
      author: "Yakuta Ali Kavazovic"
      title: "Au Grand Jamais"
      publisher: "Gallimard"
      episodeId: "68c707ad6e51b9428ab87e9e"  # pragma: allowlist secret
    calls:
      - service: "fuzzySearch"
        ref: "Yakuta Ali Kavazovic - Au Grand Jamais"
      - service: "babelioAuthor"
        ref: "Yakuta Ali Kavazovic - not found"
      - service: "babelioBook"
        ref: "Au Grand Jamais + Yakuta Ali Kavazovic ‚Üí NOT FOUND"
      - service: "babelioBook"  # Test avec suggestion ground truth
        ref: "Au grand jamais + Jakuta Alikavazovic ‚Üí VERIFIED"
    expected:
      status: "suggestion"
      author: "Jakuta Alikavazovic"  # Nom corrig√© extrait du ground truth
      title: "Au grand jamais"      # Titre corrig√© extrait du ground truth
      corrections:
        author: true
        title: true
      source: "ground_truth+babelio"

  # ‚ùì NOT FOUND CASES
  - name: "Aucune correspondance - Agn√®s Michaud"
    description: "Ni ground truth ni Babelio ne trouvent de correspondance fiable"
    input:
      author: "Agn√®s Michaud"
      title: "Huitsemences vivantes"
      publisher: "√âditeur"
      episodeId: null
    calls:
      - service: "fuzzySearch"
        ref: "Agn√®s Michaud - Huitsemences vivantes"
      - service: "babelioAuthor"
        ref: "Agn√®s Michaud - not found"
      - service: "babelioBook"
        ref: "Huitsemences vivantes + Agn√®s Michaud ‚Üí NOT FOUND"
    expected:
      status: "not_found"
      reason: "no_reliable_match_found"
      attempts: ["babelio"]

  - name: "Suggestion non valid√©e - Fausse suggestion"
    description: "Babelio sugg√®re un auteur mais le livre ne correspond pas"
    input:
      author: "Agn√®s Michaud"
      title: "Titre quelconque"
      publisher: "√âditeur"
      episodeId: null
    calls:
      - service: "fuzzySearch"
        ref: "Agn√®s Michaud - Huitsemences vivantes"  # M√™me fuzzy search
      - service: "babelioAuthor"
        ref: "Agn√®s Michaud ‚Üí Agn√®s Ouvrard-Michaud (false positive)"
      - service: "babelioBook"
        ref: "Titre quelconque + Agn√®s Ouvrard-Michaud ‚Üí NOT FOUND"
    expected:
      status: "not_found"
      reason: "suggestion_validation_failed"

  # üî¥ REAL-WORLD FAILING CASES from Episode 2025-09-07
  - name: "Episode 7/9/25 - Emmanuel Carr√®re Colcause"
    description: "FAILING: Ground truth devrait trouver Kolkhoze mais erreur de transcription"
    input:
      author: "Emmanuel Carr√®re"
      title: "Colcause"  # Erreur de transcription pour "Kolkhoze"
      publisher: "POL"
      episodeId: "68bd9ed3582cf994fb66f1d6"  # pragma: allowlist secret
    calls:
      - service: "fuzzySearch"
        ref: "Emmanuel Carr√®re - Colcause ‚Üí Kolkhoze (ground truth)"
      - service: "babelioAuthor"
        ref: "Emmanuel Carr√®re - exact match"
      - service: "babelioBook"
        ref: "Kolkhoze + Emmanuel Carr√®re ‚Üí VERIFIED"
    expected:
      status: "suggestion"
      author: "Emmanuel Carr√®re"
      title: "Kolkhoze"
      corrections:
        author: false
        title: true
      source: "ground_truth+babelio"

  - name: "Episode 7/9/25 - Fatima Das Jouer le jeu"
    description: "FAILING: Devrait sugg√©rer Fatima Daas (correction orthographique)"
    input:
      author: "Fatima Das"  # Input avec erreur
      title: "Jouer le jeu"
      publisher: "√âditions de L'Olivier"
      episodeId: "68bd9ed3582cf994fb66f1d6"  # pragma: allowlist secret
    calls:
      - service: "fuzzySearch"
        ref: "Fatima Daas - Jouer le jeu exact match"
      - service: "babelioAuthor"
        ref: "Fatima Das - API response"
      - service: "babelioBook"
        ref: "Jouer le jeu + Fatima Das - API response"
    expected:
      status: "suggestion"
      author: "Fatima Daas"  # Correction attendue
      title: "Jouer le jeu"
      corrections:
        author: true
        title: false
      source: "ground_truth+babelio"

  - name: "Episode 7/9/25 - Natacha Apana La Nuit au c≈ìur"
    description: "FAILING: Devrait √™tre valid√© par ground truth"
    input:
      author: "Natacha Apana"  # L√©g√®re diff√©rence avec "Appanah"
      title: "La Nuit au c≈ìur"
      publisher: "Gallimard"
      episodeId: "68bd9ed3582cf994fb66f1d6"  # pragma: allowlist secret
    calls:
      - service: "fuzzySearch"
        ref: "Natacha Apana - La Nuit au c≈ìur (tol√®re diff√©rence Apana/Appanah)"
      - service: "babelioAuthor"
        ref: "Natacha Apana ‚Üí Natacha Appanah"
      - service: "babelioBook"
        ref: "La Nuit au c≈ìur + Natacha Appanah ‚Üí VERIFIED"
    expected:
      status: "suggestion"
      author: "Natacha Appanah"
      title: "La Nuit au c≈ìur"
      corrections:
        author: true
        title: false
      source: "ground_truth+babelio"

  - name: "Episode 7/9/25 - Gr√©gory Lefloc Peau d'ours"
    description: "FAILING: Babelio suggestion fantaisiste au lieu de not_found"
    input:
      author: "Gr√©gory Lefloc"
      title: "Peau d'ours"
      publisher: "Seuil"
      episodeId: "68bd9ed3582cf994fb66f1d6"  # pragma: allowlist secret
    calls:
      - service: "fuzzySearch"
        ref: "Gr√©gory Lefloc - Peau d'ours NOT FOUND (pas au programme)"
      - service: "babelioAuthor"
        ref: "Gr√©gory Lefloc - not found"
      - service: "babelioBook"
        ref: "Peau d'ours + Gr√©gory Lefloc ‚Üí Henri Calet suggestion (FANTAISISTE)"
    expected:
      status: "not_found"
      reason: "no_reliable_match_found"
      attempts: ["ground_truth", "babelio"]
